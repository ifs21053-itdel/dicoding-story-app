self.addEventListener("push",(i=>{console.log("Push notification received:",i);let t={title:"Dicoding Story",options:{body:"Ada cerita baru untuk Anda!",icon:"./images/icons/web-app-manifest-192x192.png",badge:"./images/icons/web-app-manifest-72x72.png",tag:"dicoding-story-notification",data:{url:"/home"},actions:[{action:"view",title:"Lihat Cerita"},{action:"close",title:"Tutup"}]}};if(i.data)try{const o=i.data.json();console.log("Push data received:",o),t={title:o.title||"Dicoding Story",options:{body:o.options?.body||o.body||"Ada cerita baru untuk Anda!",icon:o.options?.icon||"./images/icons/web-app-manifest-192x192.png",badge:o.options?.badge||"./images/icons/web-app-manifest-72x72.png",tag:o.options?.tag||"dicoding-story-notification",data:o.options?.data||{url:"/home"},actions:o.options?.actions||[{action:"view",title:"Lihat Cerita"},{action:"close",title:"Tutup"}]}}}catch(i){console.error("Error parsing push data:",i)}i.waitUntil(self.registration.showNotification(t.title,t.options))})),self.addEventListener("notificationclick",(i=>{console.log("Notification clicked:",i),i.notification.close();const t=i.action,o=i.notification.data||{};if("close"===t)return;const e=o.url?new URL(o.url,self.location.origin).href:self.location.origin;i.waitUntil(clients.matchAll({type:"window",includeUncontrolled:!0}).then((i=>{for(let t=0;t<i.length;t++){const o=i[t];if(o.url===e&&"focus"in o)return o.focus()}if(clients.openWindow)return clients.openWindow(e)})))})),self.addEventListener("notificationclose",(i=>{console.log("Notification closed:",i),i.waitUntil(Promise.resolve())})),self.addEventListener("pushsubscriptionchange",(i=>{console.log("Push subscription changed:",i),i.waitUntil(self.registration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:"BCCs2eonMI-6H2ctvFaWg-UYdDv387Vno_bzUzALpB442r2lCnsHmtrx8biyPi_E-1fSGABK_Qs_GlvPoJJqxbk"}).then((i=>fetch("https://story-api.dicoding.dev/v1/stories/notifications/subscribe",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer YOUR_TOKEN_HERE"},body:JSON.stringify({subscription:i})}))).catch((i=>{console.error("Failed to resubscribe:",i)})))})),self.addEventListener("message",(i=>{if(console.log("Message received in service worker:",i.data),i.data&&"SHOW_NOTIFICATION"===i.data.type){const{title:t,options:o}=i.data;self.registration.showNotification(t,{body:o.body||"Notification from Dicoding Story",icon:o.icon||"./images/icons/web-app-manifest-192x192.png",badge:"./images/icons/web-app-manifest-72x72.png",tag:"manual-notification",...o})}i.data&&"CLEAR_CACHE"===i.data.type&&i.waitUntil(caches.keys().then((i=>Promise.all(i.map((i=>caches.delete(i)))))))}));